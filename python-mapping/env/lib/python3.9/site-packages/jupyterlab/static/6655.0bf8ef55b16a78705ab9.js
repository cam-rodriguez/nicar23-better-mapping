(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[6655],{26655:(e,t,s)=>{"use strict";s.r(t);s.d(t,{YBaseCell:()=>c,YCodeCell:()=>g,YDocument:()=>r,YFile:()=>d,YMarkdownCell:()=>m,YNotebook:()=>f,YRawCell:()=>y,convertYMapEventToMapChange:()=>_,createMutex:()=>b,createStandaloneCell:()=>h});var a=s(91100);var n=s(18987);var o=s(1057);var i=s(20073);class r{constructor(){this.ydoc=new i.Doc;this.ystate=this.ydoc.getMap("state");this.undoManager=new i.UndoManager([],{trackedOrigins:new Set([this]),doc:this.ydoc});this.awareness=new o.GL(this.ydoc);this.onStateChanged=e=>{const t=new Array;e.keysChanged.forEach((s=>{const a=e.changes.keys.get(s);if(a){t.push({name:s,oldValue:a.oldValue,newValue:this.ystate.get(s)})}}));this._changed.emit({stateChange:t})};this._changed=new n.Signal(this);this._isDisposed=false;this.ystate.observe(this.onStateChanged)}get changed(){return this._changed}get isDisposed(){return this._isDisposed}get state(){return a.JSONExt.deepCopy(this.ystate.toJSON())}canUndo(){return this.undoManager.undoStack.length>0}canRedo(){return this.undoManager.redoStack.length>0}dispose(){if(this._isDisposed){return}this._isDisposed=true;this.ystate.unobserve(this.onStateChanged);this.awareness.destroy();this.undoManager.destroy();this.ydoc.destroy();n.Signal.clearData(this)}getState(e){const t=this.ystate.get(e);return typeof t==="undefined"?t:a.JSONExt.deepCopy(t)}setState(e,t){if(!a.JSONExt.deepEqual(this.ystate.get(e),t)){this.ystate.set(e,t)}}undo(){this.undoManager.undo()}redo(){this.undoManager.redo()}clearUndoHistory(){this.undoManager.clear()}transact(e,t=true){this.ydoc.transact(e,t?this:null)}}class d extends r{constructor(){super();this.ysource=this.ydoc.getText("source");this._modelObserver=e=>{this._changed.emit({sourceChange:e.changes.delta})};this.undoManager.addToScope(this.ysource);this.ysource.observe(this._modelObserver)}get source(){return this.getSource()}set source(e){this.setSource(e)}dispose(){if(this.isDisposed){return}this.ysource.unobserve(this._modelObserver);super.dispose()}getSource(){return this.ysource.toString()}setSource(e){this.transact((()=>{const t=this.ysource;t.delete(0,t.length);t.insert(0,e)}))}updateSource(e,t,s=""){this.transact((()=>{const a=this.ysource;a.insert(e,s);a.delete(e+s.length,t-e)}))}}const l=(e,t={})=>{switch(e.get("cell_type")){case"code":return new g(e,e.get("source"),e.get("outputs"),t);case"markdown":return new m(e,e.get("source"),t);case"raw":return new y(e,e.get("source"),t);default:throw new Error("Found unknown cell type")}};const u=(e,t)=>{var s,n;const o=new i.Map;const r=new i.Text;o.set("source",r);o.set("metadata",{});o.set("cell_type",e.cell_type);o.set("id",(s=e.id)!==null&&s!==void 0?s:a.UUID.uuid4());let d;switch(e.cell_type){case"markdown":{d=new m(o,r,{notebook:t});if(e.attachments!=null){d.setAttachments(e.attachments)}break}case"code":{const s=new i.Array;o.set("outputs",s);d=new g(o,r,s,{notebook:t});const a=e;d.execution_count=(n=a.execution_count)!==null&&n!==void 0?n:null;if(a.outputs){d.setOutputs(a.outputs)}break}default:{d=new y(o,r,{notebook:t});if(e.attachments){d.setAttachments(e.attachments)}break}}if(e.metadata!=null){d.setMetadata(e.metadata)}if(e.source!=null){d.setSource(typeof e.source==="string"?e.source:e.source.join("\n"))}return d};const h=e=>u(e);class c{static createStandalone(e){return u({id:e,cell_type:this.prototype.cell_type})}constructor(e,t,s={}){this._modelObserver=e=>{this._changed.emit(this.getChanges(e))};this._metadataChanged=new n.Signal(this);this._notebook=null;this._changed=new n.Signal(this);this._disposed=new n.Signal(this);this._isDisposed=false;this._undoManager=null;this.ymodel=e;this._ysource=t;this._prevSourceLength=t?t.length:0;this._notebook=null;this._awareness=null;this._undoManager=null;if(s.notebook){this._notebook=s.notebook}else{const e=new i.Doc;e.getArray().insert(0,[this.ymodel]);this._awareness=new o.GL(e);this._undoManager=new i.UndoManager([this.ymodel],{trackedOrigins:new Set([this])})}this.ymodel.observeDeep(this._modelObserver)}get awareness(){var e,t,s;return(s=(e=this._awareness)!==null&&e!==void 0?e:(t=this.notebook)===null||t===void 0?void 0:t.awareness)!==null&&s!==void 0?s:null}get cell_type(){throw new Error("A YBaseCell must not be constructed")}get changed(){return this._changed}get disposed(){return this._disposed}get id(){return this.getId()}get isDisposed(){return this._isDisposed}get isStandalone(){return this._notebook!==null}get metadata(){return this.getMetadata()}set metadata(e){this.setMetadata(e)}get metadataChanged(){return this._metadataChanged}get notebook(){return this._notebook}get source(){return this.getSource()}set source(e){this.setSource(e)}get undoManager(){var e;if(!this.notebook){return this._undoManager}return((e=this.notebook)===null||e===void 0?void 0:e.disableDocumentWideUndoRedo)?this._undoManager:this.notebook.undoManager}setUndoManager(){if(this._undoManager){throw new Error("The cell undo manager is already set.")}if(this._notebook&&this._notebook.disableDocumentWideUndoRedo){this._undoManager=new i.UndoManager([this.ymodel],{trackedOrigins:new Set([this])})}}get ysource(){return this._ysource}canUndo(){return!!this.undoManager&&this.undoManager.undoStack.length>0}canRedo(){return!!this.undoManager&&this.undoManager.redoStack.length>0}clearUndoHistory(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.clear()}undo(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.undo()}redo(){var e;(e=this.undoManager)===null||e===void 0?void 0:e.redo()}dispose(){var e;if(this._isDisposed)return;this._isDisposed=true;this.ymodel.unobserveDeep(this._modelObserver);if(this._awareness){const e=this._awareness.doc;this._awareness.destroy();e.destroy()}if(this._undoManager){if(this._undoManager===((e=this.notebook)===null||e===void 0?void 0:e.undoManager)){this._undoManager=null}else{this._undoManager.destroy()}}this._disposed.emit();n.Signal.clearData(this)}getId(){return this.ymodel.get("id")}getSource(){return this.ysource.toString()}setSource(e){this.transact((()=>{this.ysource.delete(0,this.ysource.length);this.ysource.insert(0,e)}))}updateSource(e,t,s=""){this.transact((()=>{const a=this.ysource;a.insert(e,s);a.delete(e+s.length,t-e)}))}deleteMetadata(e){if(typeof this.getMetadata(e)==="undefined"){return}const t=a.JSONExt.deepCopy(this.ymodel.get("metadata"));delete t[e];if(e==="collapsed"&&t.jupyter){delete t.jupyter.outputs_hidden;if(Object.keys(t.jupyter).length===0){delete t.jupyter}}else if(e==="jupyter"){delete t.collapsed}this.setMetadata(t)}getMetadata(e){var t;const s=(t=this.ymodel.get("metadata"))!==null&&t!==void 0?t:{};if(typeof e==="string"){const t=s[e];return typeof t==="undefined"?undefined:a.JSONExt.deepCopy(s[e])}else{return a.JSONExt.deepCopy(s)}}setMetadata(e,t){var s,n,o;if(typeof e==="string"){if(typeof t==="undefined"){throw new TypeError(`Metadata value for ${e} cannot be 'undefined'; use deleteMetadata.`)}const o=e;if(a.JSONExt.deepEqual((s=this.getMetadata(o))!==null&&s!==void 0?s:null,t)){return}const i=this.getMetadata();i[o]=t;if(o==="collapsed"&&((n=i.jupyter)===null||n===void 0?void 0:n.outputs_hidden)!==t){i.jupyter={...i.jupyter,outputs_hidden:t}}else if(o==="jupyter"){if(typeof t["outputs_hidden"]!=="undefined"){if(i.collapsed!==t["outputs_hidden"]){i.collapsed=t["outputs_hidden"]}}else{delete i.collapsed}}this.transact((()=>{this.ymodel.set("metadata",i)}))}else{const t=a.JSONExt.deepCopy(e);if(t.collapsed!=null){t.jupyter=t.jupyter||{};t.jupyter.outputs_hidden=t.collapsed}else if(((o=t===null||t===void 0?void 0:t.jupyter)===null||o===void 0?void 0:o.outputs_hidden)!=null){t.collapsed=t.jupyter.outputs_hidden}if(!a.JSONExt.deepEqual(t,this.getMetadata())){this.transact((()=>{this.ymodel.set("metadata",t)}))}}}toJSON(){return{id:this.getId(),cell_type:this.cell_type,source:this.getSource(),metadata:this.getMetadata()}}transact(e,t=true){this.notebook&&t?this.notebook.transact(e):this.ymodel.doc==null?e():this.ymodel.doc.transact(e,this)}getChanges(e){var t;const s={};const n=e.find((e=>e.target===this.ymodel.get("source")));if(n){s.sourceChange=n.changes.delta}const o=e.find((e=>e.target===this.ymodel));if(o&&o.keysChanged.has("metadata")){const e=o.changes.keys.get("metadata");const n=s.metadataChange={oldValue:(e===null||e===void 0?void 0:e.oldValue)?e.oldValue:undefined,newValue:this.getMetadata()};const i=(t=n.oldValue)!==null&&t!==void 0?t:{};const r=Object.keys(i);const d=Object.keys(n.newValue);for(let t of new Set(r.concat(d))){if(!r.includes(t)){this._metadataChanged.emit({key:t,newValue:n.newValue[t],type:"add"})}else if(!d.includes(t)){this._metadataChanged.emit({key:t,oldValue:n.oldValue[t],type:"remove"})}else if(!a.JSONExt.deepEqual(i[t],n.newValue[t])){this._metadataChanged.emit({key:t,newValue:n.newValue[t],oldValue:n.oldValue[t],type:"change"})}}}const i=this.ymodel.get("source");if(o&&o.keysChanged.has("source")){s.sourceChange=[{delete:this._prevSourceLength},{insert:i.toString()}]}this._prevSourceLength=i.length;return s}}class g extends c{static createStandalone(e){return super.createStandalone(e)}constructor(e,t,s,a={}){super(e,t,a);this._youtputs=s}get cell_type(){return"code"}get execution_count(){return this.ymodel.get("execution_count")||null}set execution_count(e){if(this.ymodel.get("execution_count")!==e){this.transact((()=>{this.ymodel.set("execution_count",e)}))}}get outputs(){return this.getOutputs()}set outputs(e){this.setOutputs(e)}getOutputs(){return a.JSONExt.deepCopy(this._youtputs.toArray())}setOutputs(e){this.transact((()=>{this._youtputs.delete(0,this._youtputs.length);this._youtputs.insert(0,e)}),false)}updateOutputs(e,t,s=[]){const a=t<this._youtputs.length?t-e:this._youtputs.length-e;this.transact((()=>{this._youtputs.delete(e,a);this._youtputs.insert(e,s)}),false)}toJSON(){return{...super.toJSON(),outputs:this.getOutputs(),execution_count:this.execution_count}}getChanges(e){const t=super.getChanges(e);const s=e.find((e=>e.target===this.ymodel.get("outputs")));if(s){t.outputsChange=s.changes.delta}const a=e.find((e=>e.target===this.ymodel));if(a&&a.keysChanged.has("execution_count")){const e=a.changes.keys.get("execution_count");t.executionCountChange={oldValue:e.oldValue,newValue:this.ymodel.get("execution_count")}}return t}}class p extends c{get attachments(){return this.getAttachments()}set attachments(e){this.setAttachments(e)}getAttachments(){return this.ymodel.get("attachments")}setAttachments(e){this.transact((()=>{if(e==null){this.ymodel.delete("attachments")}else{this.ymodel.set("attachments",e)}}))}getChanges(e){const t=super.getChanges(e);const s=e.find((e=>e.target===this.ymodel));if(s&&s.keysChanged.has("attachments")){const e=s.changes.keys.get("attachments");t.executionCountChange={oldValue:e.oldValue,newValue:this.ymodel.get("attachments")}}return t}}class y extends p{static createStandalone(e){return super.createStandalone(e)}get cell_type(){return"raw"}toJSON(){return{id:this.getId(),cell_type:"raw",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}class m extends p{static createStandalone(e){return super.createStandalone(e)}get cell_type(){return"markdown"}toJSON(){return{id:this.getId(),cell_type:"markdown",source:this.getSource(),metadata:this.getMetadata(),attachments:this.getAttachments()}}}class f extends r{constructor(e={}){var t;super();this.ymeta=this.ydoc.getMap("meta");this._onMetaChanged=e=>{var t;if(e.keysChanged.has("metadata")){const s=e.changes.keys.get("metadata");const n={oldValue:(s===null||s===void 0?void 0:s.oldValue)?s.oldValue:undefined,newValue:this.getMetadata()};const o=(t=n.oldValue)!==null&&t!==void 0?t:{};const i=Object.keys(o);const r=Object.keys(n.newValue);for(let e of new Set(i.concat(r))){if(!i.includes(e)){this._metadataChanged.emit({key:e,newValue:n.newValue[e],type:"add"})}else if(!r.includes(e)){this._metadataChanged.emit({key:e,oldValue:n.oldValue[e],type:"remove"})}else if(!a.JSONExt.deepEqual(o[e],n.newValue[e])){this._metadataChanged.emit({key:e,newValue:n.newValue[e],oldValue:n.oldValue[e],type:"change"})}}this._changed.emit({metadataChange:n})}if(e.keysChanged.has("nbformat")){const t=e.changes.keys.get("nbformat");const s={key:"nbformat",oldValue:(t===null||t===void 0?void 0:t.oldValue)?t.oldValue:undefined,newValue:this.nbformat};this._changed.emit({nbformatChanged:s})}if(e.keysChanged.has("nbformat_minor")){const t=e.changes.keys.get("nbformat_minor");const s={key:"nbformat_minor",oldValue:(t===null||t===void 0?void 0:t.oldValue)?t.oldValue:undefined,newValue:this.nbformat_minor};this._changed.emit({nbformatChanged:s})}};this._onYCellsChanged=e=>{e.changes.added.forEach((e=>{const t=e.content.type;if(!this._ycellMapping.has(t)){const e=l(t,{notebook:this});e.setUndoManager();this._ycellMapping.set(t,e)}}));e.changes.deleted.forEach((e=>{const t=e.content.type;const s=this._ycellMapping.get(t);if(s){s.dispose();this._ycellMapping.delete(t)}}));let t=0;const s=[];e.changes.delta.forEach((e=>{if(e.insert!=null){const a=e.insert.map((e=>this._ycellMapping.get(e)));s.push({insert:a});this.cells.splice(t,0,...a);t+=e.insert.length}else if(e.delete!=null){s.push(e);this.cells.splice(t,e.delete)}else if(e.retain!=null){s.push(e);t+=e.retain}}));this._changed.emit({cellsChange:s})};this._metadataChanged=new n.Signal(this);this._ycells=this.ydoc.getArray("cells");this._ycellMapping=new WeakMap;this._disableDocumentWideUndoRedo=(t=e.disableDocumentWideUndoRedo)!==null&&t!==void 0?t:false;this.cells=this._ycells.toArray().map((e=>{if(!this._ycellMapping.has(e)){this._ycellMapping.set(e,l(e,{notebook:this}))}return this._ycellMapping.get(e)}));this.undoManager.addToScope(this._ycells);this._ycells.observe(this._onYCellsChanged);this.ymeta.observe(this._onMetaChanged)}get disableDocumentWideUndoRedo(){return this._disableDocumentWideUndoRedo}get metadata(){return this.getMetadata()}set metadata(e){this.setMetadata(e)}get metadataChanged(){return this._metadataChanged}get nbformat(){return this.ymeta.get("nbformat")}set nbformat(e){this.transact((()=>{this.ymeta.set("nbformat",e)}),false)}get nbformat_minor(){return this.ymeta.get("nbformat_minor")}set nbformat_minor(e){this.transact((()=>{this.ymeta.set("nbformat_minor",e)}),false)}dispose(){if(this.isDisposed){return}this._ycells.unobserve(this._onYCellsChanged);this.ymeta.unobserve(this._onMetaChanged);super.dispose()}getCell(e){return this.cells[e]}addCell(e){return this.insertCell(this._ycells.length,e)}insertCell(e,t){return this.insertCells(e,[t])[0]}insertCells(e,t){const s=t.map((e=>{const t=u(e,this);this._ycellMapping.set(t.ymodel,t);return t}));this.transact((()=>{this._ycells.insert(e,s.map((e=>e.ymodel)))}));s.forEach((e=>{e.setUndoManager()}));return s}moveCell(e,t){this.moveCells(e,t)}moveCells(e,t,s=1){const a=new Array(s).fill(true).map(((t,s)=>this.getCell(e+s).toJSON()));this.transact((()=>{this._ycells.delete(e,s);this._ycells.insert(e>t?t:t-s+1,a.map((e=>u(e,this).ymodel)))}))}deleteCell(e){this.deleteCellRange(e,e+1)}deleteCellRange(e,t){this.transact((()=>{this._ycells.delete(e,t-e)}))}deleteMetadata(e){if(typeof this.getMetadata(e)==="undefined"){return}const t=a.JSONExt.deepCopy(this.ymeta.get("metadata"));delete t[e];this.setMetadata(t)}getMetadata(e){var t;const s=(t=this.ymeta.get("metadata"))!==null&&t!==void 0?t:{};if(typeof e==="string"){const t=s[e];return typeof t==="undefined"?undefined:a.JSONExt.deepCopy(s[e])}else{return a.JSONExt.deepCopy(s)}}setMetadata(e,t){var s;if(typeof e==="string"){if(typeof t==="undefined"){throw new TypeError(`Metadata value for ${e} cannot be 'undefined'; use deleteMetadata.`)}if(a.JSONExt.deepEqual((s=this.getMetadata(e))!==null&&s!==void 0?s:null,t)){return}const n={};n[e]=t;this.updateMetadata(n)}else{if(!a.JSONExt.deepEqual(this.metadata,e)){this.ymeta.set("metadata",a.JSONExt.deepCopy(e))}}}updateMetadata(e){this.ymeta.set("metadata",{...this.getMetadata(),...e})}fromJSON(e){this.transact((()=>{this.nbformat=e.nbformat;this.nbformat_minor=e.nbformat_minor;const t=e.metadata;if(t["orig_nbformat"]!==undefined){delete t["orig_nbformat"]}this.metadata=t;const s=e.nbformat===4&&e.nbformat_minor>=5;const a=e.cells.map((e=>{if(!s){delete e.id}return e}));this.insertCells(this.cells.length,a);this.deleteCellRange(0,this.cells.length)}))}toJSON(){const e=this.nbformat===4&&this.nbformat_minor<=4;return{metadata:this.metadata,nbformat_minor:this.nbformat_minor,nbformat:this.nbformat,cells:this.cells.map((t=>{const s=t.toJSON();if(e){delete s.id}return s}))}}}function _(e){let t=new Map;e.changes.keys.forEach(((e,s)=>{t.set(s,{action:e.action,oldValue:e.oldValue,newValue:this.ymeta.get(s)})}));return t}const b=()=>{let e=true;return t=>{if(e){e=false;try{t()}finally{e=true}}}}}}]);
//# sourceMappingURL=6655.0bf8ef55b16a78705ab9.js.map?v=0bf8ef55b16a78705ab9
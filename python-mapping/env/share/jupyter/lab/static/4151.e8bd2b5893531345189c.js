(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[4151],{13119:(e,s,n)=>{"use strict";n.d(s,{M:()=>t});const t=()=>{let e=true;return(s,n)=>{if(e){e=false;try{s()}finally{e=true}}else if(n!==undefined){n()}}}},64151:(e,s,n)=>{"use strict";n.r(s);n.d(s,{WebsocketProvider:()=>J});var t=n(20073);var c=n(72382);var o=n(65679);var a=n(62794);const i=new Map;class r{constructor(e){this.room=e;this.onmessage=null;a.z((s=>s.key===e&&this.onmessage!==null&&this.onmessage({data:o.Gh(s.newValue||"")})))}postMessage(e){a.X.setItem(this.room,o.s3(o.eh(e)))}}const d=typeof BroadcastChannel==="undefined"?r:BroadcastChannel;const l=e=>c.Yu(i,e,(()=>{const s=new Set;const n=new d(e);n.onmessage=e=>s.forEach((s=>s(e.data,"broadcastchannel")));return{bc:n,subs:s}}));const h=(e,s)=>l(e).subs.add(s);const u=(e,s)=>l(e).subs.delete(s);const f=(e,s,n=null)=>{const t=l(e);t.bc.postMessage(s);t.subs.forEach((e=>e(s,n)))};var w=n(20817);var b=n(88534);var p=n(64485);const y=0;const m=1;const _=2;const g=(e,s)=>{b.uE(e,y);const n=t.encodeStateVector(s);b.mP(e,n)};const v=(e,s,n)=>{b.uE(e,m);b.mP(e,t.encodeStateAsUpdate(s,n))};const U=(e,s,n)=>v(s,n,p.HN(e));const C=(e,s,n)=>{try{t.applyUpdate(s,p.HN(e),n)}catch(c){console.error("Caught error while handling a Yjs update",c)}};const E=(e,s)=>{b.uE(e,_);b.mP(e,s)};const I=C;const M=(e,s,n,t)=>{const c=p.yg(e);switch(c){case y:U(e,s,n);break;case m:C(e,n,t);break;case _:I(e,n,t);break;default:throw new Error("Unknown message type")}return c};const k=0;const H=(e,s)=>{encoding.writeVarUint(e,k);encoding.writeVarString(e,s)};const S=(e,s,n)=>{switch(p.yg(e)){case k:n(s,p.kf(e))}};var x=n(1057);var R=n(13119);var P=n(58290);var L=n(14247);var A=n(59735);const B=e=>{const s={};const n=e.split("?");const t=n[n.length-1].split("&");for(var c=0;c<t.length;c++){const e=t[c];if(e.length>0){const n=e.split("=");s[decodeURIComponent(n[0])]=decodeURIComponent(n[1]||"")}}return s};const V=e=>A.UI(e,((e,s)=>`${encodeURIComponent(s)}=${encodeURIComponent(e)}`)).join("&");var q=n(34155);const D=0;const G=3;const W=1;const j=2;const $=[];$[D]=(e,s,n,t,c)=>{b.uE(e,D);const o=M(s,e,n.doc,n);if(t&&o===m&&!n.synced){n.synced=true}};$[G]=(e,s,n,t,c)=>{b.uE(e,W);b.mP(e,x.xq(n.awareness,Array.from(n.awareness.getStates().keys())))};$[W]=(e,s,n,t,c)=>{x.oy(n.awareness,p.HN(s),n)};$[j]=(e,s,n,t,c)=>{S(s,n.doc,Y)};const N=1200;const Z=2500;const T=3e4;const Y=(e,s)=>console.warn(`Permission denied to access ${e.url}.\n${s}`);const z=(e,s,n)=>{const t=p.l1(s);const c=b.Mf();const o=p.yg(t);const a=e.messageHandlers[o];if(a){a(c,t,e,n,o)}else{console.error("Unable to compute message")}return c};const X=e=>{if(e.shouldConnect&&e.ws===null){const s=new e._WS(e.url);s.binaryType="arraybuffer";e.ws=s;e.wsconnecting=true;e.wsconnected=false;e.synced=false;s.onmessage=n=>{e.wsLastMessageReceived=w.ZG();const t=z(e,new Uint8Array(n.data),true);if(b.kE(t)>1){s.send(b._f(t))}};s.onclose=()=>{e.ws=null;e.wsconnecting=false;if(e.wsconnected){e.wsconnected=false;e.synced=false;x.Ag(e.awareness,Array.from(e.awareness.getStates().keys()).filter((s=>s!==e.doc.clientID)),e);e.emit("status",[{status:"disconnected"}])}else{e.wsUnsuccessfulReconnects++}setTimeout(X,L.VV(L.mv(e.wsUnsuccessfulReconnects+1)*N,Z),e)};s.onopen=()=>{e.wsLastMessageReceived=w.ZG();e.wsconnecting=false;e.wsconnected=true;e.wsUnsuccessfulReconnects=0;e.emit("status",[{status:"connected"}]);const n=b.Mf();b.uE(n,D);g(n,e.doc);s.send(b._f(n));if(e.awareness.getLocalState()!==null){const n=b.Mf();b.uE(n,W);b.mP(n,x.xq(e.awareness,[e.doc.clientID]));s.send(b._f(n))}};e.emit("status",[{status:"connecting"}])}};const F=(e,s)=>{if(e.wsconnected){e.ws.send(s)}if(e.bcconnected){e.mux((()=>{f(e.bcChannel,s)}))}};class J extends P.y{constructor(e,s,n,{connect:t=true,awareness:c=new x.GL(n),params:o={},WebSocketPolyfill:a=WebSocket,resyncInterval:i=-1}={}){super();while(e[e.length-1]==="/"){e=e.slice(0,e.length-1)}const r=V(o);this.bcChannel=e+"/"+s;this.url=e+"/"+s+(r.length===0?"":"?"+r);this.roomname=s;this.doc=n;this._WS=a;this.awareness=c;this.wsconnected=false;this.wsconnecting=false;this.bcconnected=false;this.wsUnsuccessfulReconnects=0;this.messageHandlers=$.slice();this.mux=R.M();this._synced=false;this.ws=null;this.wsLastMessageReceived=0;this.shouldConnect=t;this._resyncInterval=0;if(i>0){this._resyncInterval=setInterval((()=>{if(this.ws){const e=b.Mf();b.uE(e,D);g(e,n);this.ws.send(b._f(e))}}),i)}this._bcSubscriber=e=>{this.mux((()=>{const s=z(this,new Uint8Array(e),false);if(b.kE(s)>1){f(this.bcChannel,b._f(s))}}))};this._updateHandler=(e,s)=>{if(s!==this){const s=b.Mf();b.uE(s,D);E(s,e);F(this,b._f(s))}};this.doc.on("update",this._updateHandler);this._awarenessUpdateHandler=({added:e,updated:s,removed:n},t)=>{const o=e.concat(s).concat(n);const a=b.Mf();b.uE(a,W);b.mP(a,x.xq(c,o));F(this,b._f(a))};this._beforeUnloadHandler=()=>{x.Ag(this.awareness,[n.clientID],"window unload")};if(typeof window!=="undefined"){window.addEventListener("beforeunload",this._beforeUnloadHandler)}else if(typeof q!=="undefined"){q.on("exit",(()=>this._beforeUnloadHandler))}c.on("update",this._awarenessUpdateHandler);this._checkInterval=setInterval((()=>{if(this.wsconnected&&T<w.ZG()-this.wsLastMessageReceived){this.ws.close()}}),T/10);if(t){this.connect()}}get synced(){return this._synced}set synced(e){if(this._synced!==e){this._synced=e;this.emit("synced",[e]);this.emit("sync",[e])}}destroy(){if(this._resyncInterval!==0){clearInterval(this._resyncInterval)}clearInterval(this._checkInterval);this.disconnect();if(typeof window!=="undefined"){window.removeEventListener("beforeunload",this._beforeUnloadHandler)}else if(typeof q!=="undefined"){q.off("exit",(()=>this._beforeUnloadHandler))}this.awareness.off("update",this._awarenessUpdateHandler);this.doc.off("update",this._updateHandler);super.destroy()}connectBc(){if(!this.bcconnected){h(this.bcChannel,this._bcSubscriber);this.bcconnected=true}this.mux((()=>{const e=b.Mf();b.uE(e,D);g(e,this.doc);f(this.bcChannel,b._f(e));const s=b.Mf();b.uE(s,D);v(s,this.doc);f(this.bcChannel,b._f(s));const n=b.Mf();b.uE(n,G);f(this.bcChannel,b._f(n));const t=b.Mf();b.uE(t,W);b.mP(t,x.xq(this.awareness,[this.doc.clientID]));f(this.bcChannel,b._f(t))}))}disconnectBc(){const e=b.Mf();b.uE(e,W);b.mP(e,x.xq(this.awareness,[this.doc.clientID],new Map));F(this,b._f(e));if(this.bcconnected){u(this.bcChannel,this._bcSubscriber);this.bcconnected=false}}disconnect(){this.shouldConnect=false;this.disconnectBc();if(this.ws!==null){this.ws.close()}}connect(){this.shouldConnect=true;if(!this.wsconnected&&this.ws===null){X(this);this.connectBc()}}}}}]);
//# sourceMappingURL=4151.e8bd2b5893531345189c.js.map?v=e8bd2b5893531345189c